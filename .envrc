# Set Fish as the preferred shell for scripts and subprocesses
export SHELL="$(which fish 2>/dev/null || which bash)"

# Configure environment for Fish shell if available
if command -v fish &>/dev/null; then
    export FISH_SHELL="$(which fish)"
    # Set Fish-specific environment variables
    export FISH_CONFIG_DIR="$HOME/.config/fish"
fi

# Load the Nix flake environment
use flake ./dotfiles --impure

# Additional Fish shell configuration if in direnv context
if [ -n "$FISH_SHELL" ]; then
    # Ensure Fish completions are available
    export FISH_COMPLETIONS_DIR="$HOME/.nix-profile/share/fish/completions"
    export FISH_FUNCTIONS_DIR="$HOME/.nix-profile/share/fish/functions"

    # Add Nix profile to PATH if not already present
    if [[ ":$PATH:" != *":$HOME/.nix-profile/bin:"* ]]; then
        PATH_add "$HOME/.nix-profile/bin"
    fi
fi

# Export installation-specific variables
export DOTFILES_DIR="$PWD/dotfiles"
export DOTFILES_SHELL_PREFERENCE="fish"

# Optional: Set up development environment logging
export DIRENV_LOG_FORMAT=""  # Quiet direnv output
